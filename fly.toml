# fly.toml app configuration file para betsapi-floral-rain-1393

app = "betsapi-floral-rain-1393"
primary_region = "gig"

# Configuração para manter a máquina sempre rodando
[processes]
app = "python /app/scripts/http_server.py"  # Servidor HTTP como processo principal
cron = "cron -f"  # Mantém o cron rodando em foreground

# Desativar a criação de máquinas standby
[deploy]
strategy = "immediate"
release_command = "./scripts/setup_cron.sh"

# VM para API e processamento
[[vm]]
cpu_kind = "shared"
cpus = 2
memory = "2048mb"
processes = ["app", "cron"]

[env]
PORT = "8080"

# Servidor HTTP para manter a VM viva
[http_service]
internal_port = 8080
force_https = true
auto_stop_machines = "off"
auto_start_machines = true
min_machines_running = 1
processes = ["app"]

# Executa o cron como um serviço em segundo plano
[[services]]
http_checks = []
internal_port = 8080
processes = ["cron"]
protocol = "tcp"
script_checks = []
[services.concurrency]
hard_limit = 25
soft_limit = 20
type = "connections"
